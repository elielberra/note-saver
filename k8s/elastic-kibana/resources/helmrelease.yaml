apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: elasticsearch
spec:
  interval: 5m
  chart:
    spec:
      chart: elasticsearch
      version: "22.0.6"
      sourceRef:
        kind: HelmRepository
        name: bitnami
        namespace: flux-system
  values:
    master:
      masterOnly: false
      replicaCount: 1
      heapSize: 1024m
      resources:
        limits:
          memory: "4Gi"
          cpu: "2"
        requests:
          memory: "2Gi"
          cpu: "1"
    data:
      replicaCount: 0
    coordinating:
      replicaCount: 0
    ingest:
      replicaCount: 0
    security:
      enabled: true
      elasticPassword: password
      # existingSecret: elastic-password
      tls:
        # AutoGenerate TLS certs for elastic
        autoGenerated: true
    global:
      kibanaEnabled: true
    kibana:
      resources:
        limits:
          memory: "2Gi"
          cpu: "1"
        requests:
          memory: "1Gi"
          cpu: "500m"
      elasticsearch:
        security:
          auth:
            enabled: true
            # existingSecret: elastic-password
            # kibanaUsername: "kibana_system"
            createSystemUser: true
            kibanaPassword: "password"
            elasticsearchPasswordSecret: elasticsearch
            # elasticsearchPasswordSecret: falopa # Not working, login is not shown
          tls:
            # Instruct kibana to connect to elastic over https
            enabled: true
            # Bit of a catch 22, as you will need to know the name upfront of your release
            existingSecret: elasticsearch-master-crt # or just 'elasticsearch-coordinating-crt' if the release name happens to be 'elasticsearch'
            # As the certs are auto-generated, they are pemCerts so set to true
            usePemCerts: true