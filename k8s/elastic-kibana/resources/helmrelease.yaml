apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: elasticsearch
spec:
  interval: 5m
  chart:
    spec:
      chart: elasticsearch
      version: "22.0.6"
      sourceRef:
        kind: HelmRepository
        name: bitnami
        namespace: flux-system
  values:
    master:
      masterOnly: false
      replicaCount: 1
      heapSize: 1024m
      resources:
        limits:
          memory: "4Gi"
          cpu: "2"
        requests:
          memory: "2Gi"
          cpu: "1"
    data:
      replicaCount: 0
    coordinating:
      replicaCount: 0
    ingest:
      replicaCount: 0
    security:
      enabled: true
      existingSecret: elastic-password
      tls:
        # TLS is not enabled, but needs to be configured to set authentication
        restEncryption: false
        autoGenerated: true
    global:
      kibanaEnabled: true
    kibana:
      resources:
        limits:
          memory: "2Gi"
          cpu: "1"
        requests:
          memory: "1Gi"
          cpu: "500m"
      elasticsearch:
        security:
          auth:
            enabled: true
            createSystemUser: true
            existingSecret: kibana-password
            elasticsearchPasswordSecret: elastic-password
          tls:
            # TLS is not enabled, but needs to be configured to set authentication
            enabled: false
            existingSecret: elasticsearch-master-crt
            usePemCerts: true
